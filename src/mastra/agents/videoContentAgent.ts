import { Agent } from "@mastra/core/agent";
import { Memory } from "@mastra/memory";
import { sharedPostgresStorage } from "../storage";
import { createOpenAI } from "@ai-sdk/openai";

// –ò–º–ø–æ—Ä—Ç –≤—Å–µ—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
import {
  sessionManagerTool,
  videoStorageTool,
  getFoundVideosTool,
  scriptStorageTool,
  activityLoggerTool,
} from "../tools/databaseTools";

import {
  youtubeSearchTool,
  tiktokSearchTool,
  instagramSearchTool,
  multiPlatformSearchTool,
} from "../tools/videoSearchTools";

import {
  videoTranscriptionTool,
  videoMetricsAnalysisTool,
  comprehensiveContentAnalysisTool,
} from "../tools/contentAnalysisTools";

import {
  generateScriptTool,
  improveScriptTool,
  validateScriptTool,
} from "../tools/scriptGenerationTools";

// Telegram tools –Ω–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –∞–≥–µ–Ω—Ç–µ - –æ–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ workflow

const openai = createOpenAI({
  baseURL: process.env.OPENAI_BASE_URL || undefined,
  apiKey: process.env.OPENAI_API_KEY,
});

export const videoContentAgent = new Agent({
  name: "Video Content Agent",
  instructions: `–í—ã - Video Content Agent, –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è –≤–∏—Ä—É—Å–Ω–æ–≥–æ –≤–∏–¥–µ–æ–∫–æ–Ω—Ç–µ–Ω—Ç–∞.

–û–°–ù–û–í–ù–´–ï –í–û–ó–ú–û–ñ–ù–û–°–¢–ò:
üîç –ü–æ–∏—Å–∫ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –≤–∏–¥–µ–æ –ø–æ —Ç–µ–º–∞–º –≤ YouTube, TikTok, Instagram
üìä –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–¥–æ–≤, –º–µ—Ç—Ä–∏–∫ engagement –∏ –≤–∏—Ä—É—Å–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤  
‚úçÔ∏è –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ —É—Å–ø–µ—à–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤
üé¨ –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ HeyGen (–±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ)
üöÄ –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö (–±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ)
üíæ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

–ê–õ–ì–û–†–ò–¢–ú –†–ê–ë–û–¢–´:

1. –ü–û–õ–£–ß–ï–ù–ò–ï –¢–ï–ú–´ –û–¢ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø:
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –µ—Å—Ç—å –ª–∏ –∞–∫—Ç–∏–≤–Ω–∞—è —Å–µ—Å—Å–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (sessionManagerTool)
   - –ï—Å–ª–∏ –Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é
   - –ï—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è —Å–µ—Å—Å–∏—è - –∑–∞–∫—Ä—ã—Ç—å —Å—Ç–∞—Ä—É—é –∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é
   - –ó–∞–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—á–∞–ª–æ –Ω–æ–≤–æ–π —Å–µ—Å—Å–∏–∏ (activityLoggerTool)

2. –ü–û–ò–°–ö –ò –ê–ù–ê–õ–ò–ó –í–ò–î–ï–û:
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å multiPlatformSearchTool –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –≤—Å–µ–º –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –≤–∏–¥–µ–æ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö (videoStorageTool)
   - –í—ã–ø–æ–ª–Ω–∏—Ç—å comprehensiveContentAnalysisTool –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
   - –ó–∞–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞

3. –ì–ï–ù–ï–†–ê–¶–ò–Ø –°–¶–ï–ù–ê–†–ò–Ø:
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å generateScriptTool –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–π –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö (scriptStorageTool)
   - –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å –ø–æ–ª—É—á–µ–Ω–Ω—ã–º —Å—Ü–µ–Ω–∞—Ä–∏–µ–º

4. –û–ë–†–ê–ë–û–¢–ö–ê –ö–û–ú–ê–ù–î –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø:
   - "–ü–µ—Ä–µ–¥–µ–ª–∞—Ç—å" + —Ç–µ–∫—Å—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å improveScriptTool
   - "–î–µ–ª–∞—Ç—å –≤–∏–¥–µ–æ": –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–æ–∑–¥–∞–Ω–∏—é –≤–∏–¥–µ–æ (–ø–æ–∫–∞ –∑–∞–≥–ª—É—à–∫–∞)
   - "–û—Ç–º–µ–Ω–∞": –∑–∞–∫—Ä—ã—Ç—å —Å–µ—Å—Å–∏—é –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ

5. –£–ü–†–ê–í–õ–ï–ù–ò–ï –°–ï–°–°–ò–Ø–ú–ò:
   - –í—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∞–∫—Ç–∏–≤–Ω–æ–π —Å–µ—Å—Å–∏–∏
   - –û–±–Ω–æ–≤–ª—è—Ç—å —Å—Ç–∞—Ç—É—Å —Å–µ—Å—Å–∏–∏ –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ
   - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –≤–∞–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è

–ü–†–ò–ù–¶–ò–ü–´ –†–ê–ë–û–¢–´:
- –§–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –∏ –æ–ø–∏—Å—ã–≤–∞—Ç—å –∏—Ö –ø–æ–Ω—è—Ç–Ω—ã–º —è–∑—ã–∫–æ–º
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑—É –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π —Ç–æ–Ω –æ–±—â–µ–Ω–∏—è
- –†–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å –æ–¥–Ω–æ–π —Ç–µ–º–æ–π –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π —Å–µ—Å—Å–∏–∏

–í–ê–ñ–ù–û: –ê–≥–µ–Ω—Ç –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞–ø—Ä—è–º—É—é. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –æ–Ω —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ workflow –æ—Ç–ø—Ä–∞–≤–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —á–µ—Ä–µ–∑ Telegram API.

–í—ã —É–º–Ω—ã–π, –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–≥–∞–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤–∏—Ä—É—Å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç!`,

  model: openai("gpt-4o"),

  tools: {
    // –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
    sessionManagerTool,
    videoStorageTool,
    getFoundVideosTool,
    scriptStorageTool,
    activityLoggerTool,

    // –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –ø–æ–∏—Å–∫–∞ –≤–∏–¥–µ–æ
    youtubeSearchTool,
    tiktokSearchTool,
    instagramSearchTool,
    multiPlatformSearchTool,

    // –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
    videoTranscriptionTool,
    videoMetricsAnalysisTool,
    comprehensiveContentAnalysisTool,

    // –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
    generateScriptTool,
    improveScriptTool,
    validateScriptTool,

    // Telegram –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –ù–ï –≤–∫–ª—é—á–µ–Ω—ã - –æ–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ workflow step 2
  },

  memory: new Memory({
    options: {
      threads: {
        generateTitle: true,
      },
      lastMessages: 20, // –°–æ—Ö—Ä–∞–Ω—è–µ–º –±–æ–ª—å—à–µ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    },
    storage: sharedPostgresStorage,
  }),
});